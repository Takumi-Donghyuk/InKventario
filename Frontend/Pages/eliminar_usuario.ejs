<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Eliminar usuario</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
<div class="flex justify-center">
    <!-- Botón de menú principal -->
    <div class="w-full max-w-md mb-6">
        <a href="/admin" class="block text-center bg-purple-600 text-white font-semibold py-2 px-4 rounded hover:bg-purple-700 transition">
            Volver al panel principal
        </a>
    </div>
</div>
<main class="max-w-6xl mx-auto">
<h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Lista de usuarios para eliminar</h1>
</main>
  <!-- Tabla -->
  <div class="overflow-x-auto bg-white shadow-lg rounded-lg">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-purple-600 text-white">
          <tr>
            <th class="px-6 py-3 text-center text-sm font-medium uppercase tracking-wider">Nombre</th>
            <th class="px-6 py-3 text-center text-sm font-medium uppercase tracking-wider">Correo</th>
            <th class="px-6 py-3 text-center text-sm font-medium uppercase tracking-wider">Teléfono</th>
            <th class="px-6 py-3 text-center text-sm font-medium uppercase tracking-wider">Rol</th>
            <th class="px-6 py-3 text-center text-sm font-medium uppercase tracking-wider">Fecha de creación</th>
            <th class="px-6 py-3 text-center text-sm font-medium uppercase tracking-wider">Acción</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% usuarios.forEach(u => { %>
            <tr class="hover:bg-gray-100 transition">
              <td class="px-6 py-4 whitespace-nowrap text-gray-700 font-medium text-center"><%= u.nombre %></td>
              <td class="px-6 py-4 whitespace-nowrap text-gray-700 text-center"><%= u.correo %></td>
              <td class="px-6 py-4 whitespace-nowrap text-gray-700 text-center"><%= u.telefono %></td>
              <td class="px-6 py-4 whitespace-nowrap text-gray-700 text-center"><%= u.rol %></td>
              <td class="px-6 py-4 whitespace-nowrap text-gray-700 text-center"><%= u.fecha_creacion %></td>
              <td class="px-6 py-4 whitespace-nowrap text-center">
                <button onclick="eliminarUsuario(<%= u.id_usuario %>)"
                class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded 
                font-semibold transition">
                Eliminar
                </button>
              </td>
            </tr>
          <% }) %>
        </tbody>
    </table>
  </div>  
</body>

<script>
async function eliminarUsuario(id) {
  const resultado = await Swal.fire({
    title: '¿Estás seguro?',
    text: "¡No podrás revertir esto!",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#d33',
    cancelButtonColor: '#3085d6',
    confirmButtonText: 'Sí, eliminar',
    cancelButtonText: 'Cancelar'
  });

  if (!resultado.isConfirmed) return; 
  try {
    const res = await fetch(`/usuarios/eliminar/${id}`, {
      method: 'DELETE'
    });

    if (res.ok) {
      await Swal.fire({
        icon: 'success',
        title: '¡Eliminado!',
        text: 'Usuario eliminado correctamente',
        timer: 1500,
        showConfirmButton: false
      });
      window.location.href = '/admin';
    } else {
      const msg = await res.text();
      Swal.fire({
        icon: 'error',
        title: 'Error',
        text: msg
      });
    }
  } catch (err) {
    console.error(err);
    Swal.fire({
      icon: 'error',
      title: 'Error',
      text: 'Error al eliminar el usuario'
    });
  }
}
</script>

</html>